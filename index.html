<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Unisonic Hockey Game</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; font-family: sans-serif; color: white; }
    canvas { display: block; margin: 0 auto; background: #111; }
  </style>
</head>
<body>
<canvas id="gameCanvas" width="640" height="480"></canvas>
<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  let gameStarted = false;
  let paddle1Y = 200, paddle2Y = 200;
  const paddleHeight = 60, paddleWidth = 10;
  let puckX = canvas.width / 2, puckY = canvas.height / 2;
  let puckSpeedX = 0, puckSpeedY = 0;
  const puckRadius = 8;
  let score1 = 0, score2 = 0;
  let keys = {};
  let serveTimeout = null;
  let lastScorer = 1;

  const goalWidth = 60;

  // Sounds
  const hitSound = new Audio("https://actions.google.com/sounds/v1/impacts/wobble.ogg");
  const scoreSound = new Audio("https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg");

  function resetPuck() {
    puckX = canvas.width / 2;
    puckY = canvas.height / 2;
    puckSpeedX = 0;
    puckSpeedY = 0;
    if (serveTimeout) clearTimeout(serveTimeout);
    serveTimeout = setTimeout(() => {
      puckSpeedX = lastScorer === 1 ? 4 : -4;
      puckSpeedY = Math.random() * 4 - 2;
    }, 1000);
  }

  function drawRect(x, y, w, h, color = "white") {
    ctx.fillStyle = color;
    ctx.fillRect(x, y, w, h);
  }

  function drawCircle(x, y, r, color = "white") {
    ctx.fillStyle = color;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fill();
  }

  function drawCenterLine() {
    ctx.strokeStyle = "white";
    ctx.setLineDash([5, 15]);
    ctx.beginPath();
    ctx.moveTo(canvas.width / 2, 0);
    ctx.lineTo(canvas.width / 2, canvas.height);
    ctx.stroke();
    ctx.setLineDash([]);
  }

  function drawScore() {
    ctx.font = "32px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(score1, canvas.width / 4, 40);
    ctx.fillText(score2, (canvas.width * 3) / 4, 40);
  }

  function moveEverything() {
    if (!gameStarted) return;

    if (keys["w"] && paddle1Y > 0) paddle1Y -= 5;
    if (keys["s"] && paddle1Y < canvas.height - paddleHeight) paddle1Y += 5;
    if (keys["ArrowUp"] && paddle2Y > 0) paddle2Y -= 5;
    if (keys["ArrowDown"] && paddle2Y < canvas.height - paddleHeight) paddle2Y += 5;

    puckX += puckSpeedX;
    puckY += puckSpeedY;

    // Bounce off top and bottom
    if (puckY < puckRadius || puckY > canvas.height - puckRadius) {
      puckSpeedY = -puckSpeedY;
    }

    // Paddle collision
    if (puckX - puckRadius < 20 && puckY > paddle1Y && puckY < paddle1Y + paddleHeight) {
      puckSpeedX = -puckSpeedX;
      hitSound.play();
    }

    if (puckX + puckRadius > canvas.width - 20 && puckY > paddle2Y && puckY < paddle2Y + paddleHeight) {
      puckSpeedX = -puckSpeedX;
      hitSound.play();
    }

    // Goal detection
    if (puckX < 0) {
      score2++;
      lastScorer = 2;
      scoreSound.play();
      resetPuck();
    }

    if (puckX > canvas.width) {
      score1++;
      lastScorer = 1;
      scoreSound.play();
      resetPuck();
    }
  }

  function drawEverything() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawCenterLine();
    drawScore();
    drawRect(10, paddle1Y, paddleWidth, paddleHeight);
    drawRect(canvas.width - 20, paddle2Y, paddleWidth, paddleHeight);
    drawCircle(puckX, puckY, puckRadius);

    if (!gameStarted) {
      ctx.font = "20px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("Click to focus, then press G to start", canvas.width / 2, canvas.height / 2);
    }
  }

  function gameLoop() {
    moveEverything();
    drawEverything();
    requestAnimationFrame(gameLoop);
  }

  document.addEventListener("keydown", (e) => {
    keys[e.key] = true;
    if (e.key.toLowerCase() === "g" && !gameStarted) {
      gameStarted = true;
      resetPuck();
    }
  });

  document.addEventListener("keyup", (e) => {
    keys[e.key] = false;
  });

  canvas.addEventListener("click", () => {
    canvas.focus();
  });

  gameLoop();
</script>
</body>
</html>
